@startuml enhanced-logging-info-flow

!include _standard-style.puml

title Information Flow in Enhanced Live Logging System

actor User
participant "Claude Code" as Claude
participant "StatusLine" as Status  
participant "LiveLoggingCoordinator" as Coordinator
participant "SemanticToolInterpreter" as Interpreter
participant "ExchangeClassifier" as Classifier
participant "HybridSessionLogger" as Logger
database "Coding Logs" as CodingDB
database "Project Logs" as ProjectDB

User -> Claude : Uses tool (e.g., Read file)
activate Claude

Claude -> Status : Tool interaction occurs
activate Status
Status -> Coordinator : captureToolInteraction(toolCall, result)
activate Coordinator

note right of Coordinator
    Real-time capture of:
    â€¢ Tool name & parameters
    â€¢ Execution result
    â€¢ Context & timestamp
end note

Coordinator -> Interpreter : summarize(toolCall, result, context)
activate Interpreter

Interpreter -> Interpreter : Analyze tool type
note right
    Route to appropriate interpreter:
    â€¢ File ops â†’ file summary
    â€¢ Commands â†’ command summary  
    â€¢ MCP tools â†’ server-specific format
end note

Interpreter -> Coordinator : Meaningful summary with icon & details
deactivate Interpreter

note left of Coordinator
    Summary example:
    ðŸ“– **Read**: `UserProfile.js` (150 lines)
    Details: Component definition with hooks
end note

Coordinator -> Classifier : classifyExchange(exchange, context)
activate Classifier

Classifier -> Classifier : Score against indicators
note right
    Scoring algorithm:
    â€¢ Tools used (MCP, knowledge mgmt)
    â€¢ Files accessed (coding patterns)
    â€¢ Commands run (system ops)
    â€¢ Concepts referenced (knowledge terms)
    â€¢ Working directory context
end note

Classifier -> Classifier : Calculate confidence & target
Classifier -> Coordinator : Classification result
deactivate Classifier

note left of Coordinator
    Classification:
    â€¢ target: "coding" | "project"  
    â€¢ confidence: 0.85
    â€¢ hybrid: true/false
    â€¢ reasons: ["Uses MCP tool", "Access coding file"]
end note

Coordinator -> Logger : onToolInteraction(toolCall, result, classification)
activate Logger

alt Classification is "hybrid" (both coding and project relevant)
    Logger -> CodingDB : Log with "Cross-project impact" context
    Logger -> ProjectDB : Log with "Local project context" context
    note right
        Hybrid exchanges get logged to BOTH
        locations with appropriate context
    end note
else Classification is "coding" (system/knowledge work)
    Logger -> CodingDB : Log with "Knowledge management" context
else Classification is "project" (feature/bug work)
    Logger -> ProjectDB : Log with "Project development" context
end

Logger -> Coordinator : Exchange logged successfully
deactivate Logger

Coordinator -> Status : Processing complete
deactivate Coordinator
Status -> Claude : Tool interaction captured
deactivate Status

Claude -> User : Tool result + enhanced logging active
deactivate Claude

note over CodingDB, ProjectDB
    Log entries contain:
    â€¢ Meaningful tool summaries (not "[Tool: X]")
    â€¢ Full context and reasoning
    â€¢ Classification confidence scores
    â€¢ Timestamp and session metadata
    â€¢ Cross-references for hybrid exchanges
end note

@enduml