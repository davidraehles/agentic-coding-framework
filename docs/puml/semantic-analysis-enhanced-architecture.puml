@startuml semantic-analysis-enhanced-architecture
!include _standard-style.puml

title Current Semantic Analysis System - 10 Agent Architecture

package "MCP Integration" {
  [Claude Code] as CLAUDE <<external>>
  [MCP Protocol Handler] as MCP_SERVER <<api>>
  [12 MCP Tools] as TOOLS <<api>>
}

package "Agent Layer - 10 Agents" {
  package "Core Analysis Agents (8)" {
    [Git History\nAgent] as GIT_AGENT <<agent>>
    [Vibe History\nAgent] as VIBE_AGENT <<agent>>
    [Semantic Analysis\nAgent] as SEMANTIC_AGENT <<agent>>
    [Web Search\nAgent] as SEARCH_AGENT <<agent>>
    [Insight Generation\nAgent] as INSIGHT_AGENT <<agent>>
    [Observation Generation\nAgent] as OBS_AGENT <<agent>>
    [Quality Assurance\nAgent] as QA_AGENT <<agent>>
    [Persistence\nAgent] as PERSIST_AGENT <<agent>>
  }
  
  package "Infrastructure Agents (2)" {
    [Synchronization\nAgent] as SYNC_AGENT <<agent>>
    [Deduplication\nAgent] as DEDUP_AGENT <<agent>>
  }
  
  package "Orchestration Service" {
    [Coordinator\nService] as COORDINATOR <<infra>>
  }
}

package "Knowledge Storage" {
  database [MCP Memory\nService] as MCP_MEMORY <<storage>>
  database [Graphology\nDatabase] as GRAPHOLOGY_DB <<storage>>
  database [shared-memory-\ncoding.json] as JSON_FILES <<storage>>
}

package "External Services" {
  cloud [Anthropic\nClaude] as ANTHROPIC_API <<external>>
  cloud [OpenAI\nGPT] as OPENAI_API <<external>>
  cloud [Web Search\nAPIs] as WEB_APIS <<external>>
}

' MCP Integration Flow
CLAUDE SYNC_LINE MCP_SERVER
MCP_SERVER SYNC_LINE TOOLS
TOOLS SYNC_LINE COORDINATOR

' Agent Coordination (Direct Function Calls)
COORDINATOR CONTROL_LINE GIT_AGENT
COORDINATOR CONTROL_LINE VIBE_AGENT
COORDINATOR CONTROL_LINE SEMANTIC_AGENT
COORDINATOR CONTROL_LINE SEARCH_AGENT
COORDINATOR CONTROL_LINE INSIGHT_AGENT
COORDINATOR CONTROL_LINE OBS_AGENT
COORDINATOR CONTROL_LINE QA_AGENT
COORDINATOR CONTROL_LINE PERSIST_AGENT
COORDINATOR CONTROL_LINE SYNC_AGENT
COORDINATOR CONTROL_LINE DEDUP_AGENT

' Agent Workflow Sequence
GIT_AGENT ASYNC_LINE VIBE_AGENT
VIBE_AGENT ASYNC_LINE SEMANTIC_AGENT
SEMANTIC_AGENT ASYNC_LINE SEARCH_AGENT
SEARCH_AGENT ASYNC_LINE INSIGHT_AGENT
INSIGHT_AGENT ASYNC_LINE OBS_AGENT
OBS_AGENT ASYNC_LINE QA_AGENT
QA_AGENT ASYNC_LINE PERSIST_AGENT
PERSIST_AGENT ASYNC_LINE SYNC_AGENT
SYNC_AGENT ASYNC_LINE DEDUP_AGENT

' Storage Connections
SYNC_AGENT DATA_LINE MCP_MEMORY
SYNC_AGENT DATA_LINE GRAPHOLOGY_DB
SYNC_AGENT DATA_LINE JSON_FILES
PERSIST_AGENT DATA_LINE MCP_MEMORY

' External API Connections
SEMANTIC_AGENT OPTIONAL_LINE ANTHROPIC_API
SEMANTIC_AGENT OPTIONAL_LINE OPENAI_API
SEARCH_AGENT OPTIONAL_LINE WEB_APIS
INSIGHT_AGENT OPTIONAL_LINE ANTHROPIC_API

note right of COORDINATOR
  **Workflow Orchestration**
  • Coordinates all 10 agents
  • Direct function calls (no MQTT)
  • Quality assurance pipeline
  • Error handling and retry logic
end note

note right of SYNC_AGENT
  **Data Synchronization**
  • Multi-source data sync
  • Real-time file watching
  • Conflict resolution
  • Cross-session persistence
end note

note bottom of GIT_AGENT
  **8-Agent Sequential Workflow:**
  Git History → Vibe History → Semantic Analysis
  → Web Search → Insight Generation → Observation
  → Quality Assurance → Persistence
end note

@enduml