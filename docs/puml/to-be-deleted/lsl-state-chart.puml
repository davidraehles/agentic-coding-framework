@startuml
!include _standard-style.puml
title LSL/Trajectory System State Chart

[*] --> Idle : System startup

state Idle {
  Idle : Monitor for transcript changes
  Idle : Check project detection
  Idle : Wait for session activity
}

state SessionActive {
  SessionActive : Process transcript entries
  SessionActive : Generate LSL content
  SessionActive : Update status line
}

state ContentClassification {
  ContentClassification : Analyze prompt content
  ContentClassification : Check for coding indicators
  ContentClassification : Determine routing target
}

state Redirect {
  Redirect : Update redirect status file
  Redirect : Route to coding project
  Redirect : Generate trajectory analysis
}

state TrajectoryGeneration {
  TrajectoryGeneration : Extract semantic patterns
  TrajectoryGeneration : Generate AI analysis
  TrajectoryGeneration : Create trajectory file
}

state SessionEnd {
  SessionEnd : Finalize LSL file
  SessionEnd : Complete trajectory analysis
  SessionEnd : Update session status
}

state ConstraintCheck {
  ConstraintCheck : Monitor file changes
  ConstraintCheck : Detect violations
  ConstraintCheck : Update compliance score
}

Idle --> SessionActive : New transcript detected
SessionActive --> ContentClassification : Process user prompt
ContentClassification --> Redirect : Coding content detected
ContentClassification --> SessionActive : Non-coding content
Redirect --> TrajectoryGeneration : Generate semantic analysis
TrajectoryGeneration --> SessionActive : Continue session
SessionActive --> ConstraintCheck : File modifications detected
ConstraintCheck --> SessionActive : Constraints checked
SessionActive --> SessionEnd : Session timeout/end
SessionEnd --> Idle : Reset for next session

' Error states
SessionActive --> Idle : Error/timeout
ContentClassification --> SessionActive : Classification failed
TrajectoryGeneration --> SessionActive : AI service unavailable

' Background processes
SessionActive --> SessionActive : Real-time updates
ConstraintCheck --> ConstraintCheck : Continuous monitoring

@enduml