@startuml lsl-v3-architecture
!include _standard-style.puml

title LSL System v3.0 - Conversation-Based Architecture

package "Claude Code Session" {
  [User Interactions] as User
  [Tool Calls] as Tools
  [Transcript Generation] as Transcript
}

package "Enhanced Transcript Monitor v3.0" {
  [Conversation Context Analyzer] as Analyzer
  [Working Directory Tracker] as WorkingDir
  [Path Resolution Engine] as PathResolver
  [Redirect Detection Engine] as RedirectEngine
}

package "Claude Code Hook System" {
  [PostToolUse Hook] as Hook
  [Status Line Updates] as Updates
  [Status Display] as StatusDisplay
}

package "LSL Documentation System" {
  [LSL Generator] as LSLGen
  [Session Documentation] as SessionDocs
  [Project Trajectory] as Trajectory
}

package "Context Tracking" {
  [Working Directory Context] as DirContext
  [Conversation State] as ConvState
  [Relative Path Resolution] as RelativePath
}

User --> Transcript
Tools --> Transcript
Transcript --> Analyzer

Analyzer --> WorkingDir
WorkingDir --> DirContext
DirContext --> PathResolver
PathResolver --> RelativePath

Analyzer --> RedirectEngine
RedirectEngine --> ConvState

RedirectEngine --> Hook
Hook --> Updates
Updates --> StatusDisplay

Analyzer --> LSLGen
LSLGen --> SessionDocs
SessionDocs --> Trajectory

note right of WorkingDir
  **v3.0 Innovation**
  Tracks cwd from transcript 
  metadata for context-aware
  path resolution
end note

note right of RedirectEngine
  **Enhanced Detection**
  Analyzes complete conversation
  instead of individual files
  
  Maintains â†’coding indicator
  throughout work sessions
end note

note right of Hook
  **Hook-Driven Updates**
  Claude Code triggers status
  line updates after each tool use
  
  Native integration with IDE
end note

@enduml