@startuml lsl-architecture
!include _standard-style.puml

title Live Session Logging (LSL) Architecture

top to bottom direction

package "Claude Code Session" {
  [Launch Script] as Launch <<external>>
  [User Interactions] as User <<external>>
  [Real-time Transcript] as Transcript <<external>>
}

package "4-Layer Monitoring" #FFE6E6 {
  [System Watchdog] as Watchdog <<infra>>
  [Service Coordinator] as GSC <<infra>>
  [Monitoring Verifier] as Verifier <<infra>>
}

package "Enhanced Transcript Monitor" {
  [Transcript Analyzer] as Analyzer <<core>>
  [Transition Detector] as Detector <<core>>
}

package "5-Layer Classifier" #E8F5E8 {
  [Layer 0: Session Filter] as L0 <<core>>
  [Layer 1: Path Analyzer] as L1 <<core>>
  [Layer 2: Keyword Matcher] as L2 <<core>>
  [Layer 3: Embedding] as L3 <<core>>
  [Layer 4: Semantic] as L4 <<agent>>
  [Orchestrator] as Orchestrator <<core>>
}

package "Session Router" {
  [Router] as Router <<core>>
  [Logger] as Logger <<core>>
}

package "Storage" {
  database "Project\nHistory" as ProjectHistory <<storage>>
  database "Coding\nHistory" as CodingHistory <<storage>>
}

' Main flow
Launch --> Verifier : verify
Verifier --> Watchdog : check
Verifier --> GSC : check
Verifier --> Analyzer : validate

Launch --> User : start
User --> Transcript : generate
Transcript --> Analyzer : monitor

Analyzer --> Detector : transitions
Analyzer --> Orchestrator : classify

' Classification cascade
Orchestrator --> L0 : bias check
L0 --> L1 : file patterns
L1 --> L2 : keywords
L2 --> L3 : similarity
L3 --> L4 : semantic

' Routing
Orchestrator --> Router : result
Router --> Logger : route

' Storage
Logger --> ProjectHistory : NOT_CODING
Logger --> CodingHistory : CODING

' Monitoring
Watchdog --> GSC : monitors
GSC --> Analyzer : manages

@enduml